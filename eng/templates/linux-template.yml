jobs:
  - ${{ each image in parameters.images }}:
    - ${{ each configuration in parameters.configurations }}:
      - ${{ each platform in parameters.platforms }}:

        - job:

          displayName: '${{ image }} (${{ configuration }}) (${{ platform }})'
          pool:
            vmImage: ubuntu-latest

          container: ${{ image }} 

          steps:

            - script: ls -a &&
                      chmod +x ./build.sh &&
                      chmod +x eng/common/build.sh
                      chmod +x eng/common/tools.sh
              name: set_execution_permission

            - script: ./build.sh -t -integrationTest -c $CONFIGURATION -platform $PLATFORM -pack -ci
              name: build_and_test
              env:
                CONFIGURATION: ${{ configuration }}
                PLATFORM: ${{ platform }}
            
            - publish: $(system.defaultworkingdirectory)/artifacts
              artifact: '${{ image }}_${{ configuration }}_${{ platform }}'
