parameters:
  image: ''
  configuration: ''
  platform: ''

- job:

  displayName: '${{ image }} (${{ configuration }}) (${{ platform }})'
  pool:
    vmImage: ${{ image }}

  - template: steps.yaml
    parameters:
      - script: echo "##vso[task.setvariable variable=prefix]$(echo ${IMAGE//[[:punct:]]/-})"
        name: evaluate_artifact_name
        env:
          IMAGE: ${{ image }}

      - script: chmod +x build.sh &&
              cd eng/common &&
              chmod +x build.sh &&
              chmod +x tools.sh
        name: set_execution_permission

      - script: ./build.sh -t -integrationTest -c $CONFIGURATION -platform $PLATFORM -pack -ci
        name: build_and_test
        env:
          CONFIGURATION: ${{ configuration }}
          PLATFORM: ${{ platform }}
